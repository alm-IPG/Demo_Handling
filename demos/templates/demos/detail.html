{% extends 'base.html' %}
{% block title %}{{ demo.title }} – Demo Portal{% endblock %}
{% block content %}
  <article class="detail">
    <header class="detail-header">
      {% if demo.thumbnail_path %}
        <img class="hero" src="{% url 'thumb' demo.slug %}" alt="thumbnail" />
      {% else %}
        <div class="hero placeholder"></div>
      {% endif %}

      <div>
        <h1>{{ demo.title }}</h1>
        <p>{{ demo.summary }}</p>
        <div class="meta">
          {% if cm_bucket %}<span class="cm">{{ cm_bucket }}</span>{% endif %}
          {% for t in demo.tags %}<span class="tag">{{ t }}</span>{% endfor %}
        </div>
        {# actions removed per 4.2 #}
      </div>

      <aside class="info-panel">
        <h3>Details</h3>
        <dl class="kv">
          <dt>State</dt><dd><span class="pill state {{ demo.state|slugify }}">{{ demo.state }}</span></dd>
          <dt>Owner</dt><dd>{{ demo.owner }}</dd>
          <dt>CarMaker</dt><dd>{{ cm_bucket }}</dd>
        </dl>
      </aside>
    </header>

    {% if demo.files_meta %}
      <section>
        <h2>Highlighted files</h2>
        <ul class="highlights">
          {% for f in demo.files_meta %}
            <li>
              <code>{{ f.path }}</code>
              <div class="desc">{{ f.description }}</div>
            </li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}

    <section>
      <h2>All files</h2>
      {% include 'demos/_tree.html' with node=tree %}
    </section>

    <!-- Comments (read-only) -->
    <section class="comments">
      <h2>Comments</h2>

      {% if comments %}
        <ul class="comment-list">
          {% for c in comments %}
            <li>
              <div class="meta">
                {{ c.user|default:"" }}
                {% if c.timestamp %} – {{ c.timestamp }}{% endif %}
              </div>
              <div class="text">{{ c.text }}</div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No comments yet.</p>
      {% endif %}

      <!-- Read-only placeholder (disabled) -->
      <form class="comment-form">
        <textarea rows="3" placeholder="Comments are read-only for now." disabled></textarea><br />
        <button class="btn" type="button" disabled>Post comment</button>
      </form>
    </section>
  </article>
{% endblock %}
